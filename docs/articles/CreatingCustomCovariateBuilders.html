<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating custom covariate builders • FeatureExtraction</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating custom covariate builders">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FeatureExtraction</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CreatingCovariatesBasedOnOtherCohorts.html">Creating covariates based on other cohorts</a>
    </li>
    <li>
      <a href="../articles/CreatingCovariatesUsingCohortAttributes.html">Creating covariates using cohort attributes</a>
    </li>
    <li>
      <a href="../articles/CreatingCustomCovariateBuilders.html">Creating custom covariate builders</a>
    </li>
    <li>
      <a href="../articles/CreatingCustomCovariateBuildersKorean.html">Creating custom covariate builders (Korean)</a>
    </li>
    <li>
      <a href="../articles/UsingFeatureExtraction.html">Using FeatureExtraction</a>
    </li>
    <li>
      <a href="../articles/UsingFeatureExtractionKorean.html">Using FeatureExtraction (Korean)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/FeatureExtraction/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating custom covariate builders</h1>
                        <h4 data-toc-skip class="author">Martijn J.
Schuemie</h4>
            
            <h4 data-toc-skip class="date">2025-10-28</h4>

      <small class="dont-index">Source: <a href="https://github.com/OHDSI/FeatureExtraction/blob/HEAD/vignettes/CreatingCustomCovariateBuilders.Rmd" class="external-link"><code>vignettes/CreatingCustomCovariateBuilders.Rmd</code></a></small>
      <div class="hidden name"><code>CreatingCustomCovariateBuilders.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette assumes you are already familiar with the
<code>FeatureExtraction</code> package.</p>
<p>The <code>FeatureExtraction</code> package can generate a default set
of covariates, such as one covariate for each condition found in the
<code>condition_occurrence</code> table. However, for some reasons one
might need other covariates than those included in the default set.
Sometimes it might make sense to request the new covariates be added to
the standard list, but other times there is good reason to keep them
separated.</p>
<p>The <code>FeatureExtraction</code> package has a mechanism for
including custom covariate builders to either replace or complement the
covariate builders included in the package. This vignette describes that
mechanism.</p>
<p>Note: another way to add custom covariates is by using the
<code>cohort_attribute</code> table in the common data model. This
approach is described in the vignette called
<code>creating covariates using cohort attributes</code>, and might be
more suitable if you are likely to need the covariates only once, or
when you are less familiar with advanced R programming. Creating a
custom covariate builder as described in this vignette is more
complicated, but once completed can easily be reused in many
studies.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>To add a custom covariate builder, two things need to be
implemented:</p>
<ol style="list-style-type: decimal">
<li>A function that creates a <code>covariateSettings</code> object for
the custom covariates.</li>
<li>A function that uses the covariate settings to construct the new
covariates.</li>
</ol>
</div>
<div class="section level2">
<h2 id="covariate-settings-function">Covariate settings function<a class="anchor" aria-label="anchor" href="#covariate-settings-function"></a>
</h2>
<p>The covariate settings function must create an object that meets two
requirements:</p>
<ol style="list-style-type: decimal">
<li>The object must be of class <code>covariateSettings</code>.</li>
<li>The object must have an attribute <code>fun</code> that specifies
the name of the function for generating the covariates.</li>
</ol>
<div class="section level3">
<h3 id="example-function">Example function<a class="anchor" aria-label="anchor" href="#example-function"></a>
</h3>
<p>Here is an example covariate settings function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">createLooCovariateSettings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">useLengthOfObs</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>useLengthOfObs <span class="op">=</span> <span class="va">useLengthOfObs</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">covariateSettings</span>, <span class="st">"fun"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"getDbLooCovariateData"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">covariateSettings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"covariateSettings"</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">covariateSettings</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this example the function has only one argument:
<code>useLengthOfObs</code>. This argument is stored in the
<code>covariateSettings</code> object. We specify that the name of the
function that will construct the covariates corresponding to these
options is <code>getDbLooCovariateData</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="covariate-construction-function">Covariate construction function<a class="anchor" aria-label="anchor" href="#covariate-construction-function"></a>
</h2>
<div class="section level3">
<h3 id="function-inputs">Function inputs<a class="anchor" aria-label="anchor" href="#function-inputs"></a>
</h3>
<p>The covariate construction function has to accept the following
arguments:</p>
<ul>
<li>
<code>connection</code>: A connection to the server containing the
schema as created using the <code>connect</code> function in the
<code>DatabaseConnector</code> package.</li>
<li>
<code>tempEmulationSchema</code>: Schema for emulating temp tables
on Oracle, Impala, and similar platforms.</li>
<li>
<code>cdmDatabaseSchema</code>: The name of the database schema that
contains the OMOP CDM instance. On SQL Server, this will specify both
the database and the schema, so for example ‘cdm_instance.dbo’.</li>
<li>
<code>cdmVersion</code>: Defines the OMOP CDM version used:
currently supports “4” and “5”.</li>
<li>
<code>cohortTable</code>: Name of the table holding the cohort for
which we want to construct covariates. This is a fully specified name,
so either the name of a temp table (e.g. ‘#cohort_table’), or a
permanent table including its database schema
(e.g. ‘cdm_schema.dbo.cohort’).</li>
<li>
<code>cohortIds</code>: The cohort definition IDs of the cohort. If
set to -1, use all entries in the cohort table.</li>
<li>
<code>rowIdField</code>: The name of the field in the cohort temp
table that is to be used as the row_id field in the output table. This
can be especially usefull if there is more than one period per
person.</li>
<li>
<code>covariateSettings</code>: The object created in your covariate
settings function.</li>
<li>
<code>aggregated</code>: Should covariates be constructed
per-person, or aggregated across the cohort?</li>
<li>
<code>minCharacterizationMean</code>: The minimum mean value for
characterization output. Values below this will be cut off from output.
This will help reduce the file size of the characterization output, but
will remove information on covariates that have very low values. The
default is 0. Note: this parameter only works when
<code>aggregated</code> is set to TRUE. Since aggregation is not
supported in this function, it doesn’t actually filter the output.
However, the <code>getDbCovariateData</code> function requires this
parameter to be present.</li>
</ul>
<p>The function can expect that a table exists with the name specified
in the <code>cohortTable</code> argument. This table will identify the
persons and the index dates for which we want to construct the
covariates, and will have the following fields: <code>subject_id</code>,
<code>cohort_start_date</code>, and <code>cohort_definition_id</code>.
Because sometimes there can be more than one index date
(i.e. <code>cohort_start_date</code>) per person, an additional field
can be included with a unique identifier for each
<code>subject_id</code> - <code>cohort_start_date</code> combination.
The name of this field will be specified in the <code>rowIdField</code>
argument</p>
</div>
<div class="section level3">
<h3 id="function-outputs">Function outputs<a class="anchor" aria-label="anchor" href="#function-outputs"></a>
</h3>
<p>The function must return an object of type
<code>CovariateData</code>, which is an Andromeda object with the
following members:</p>
<ul>
<li>
<code>covariates</code>, listing the covariates per row ID. This is
done using a sparse representation; covariates with a value of 0 are
omitted to save space. The covariates object must have three columns:
<code>rowId</code>, <code>covariateId</code>, and
<code>covariateValue</code>.</li>
<li>
<code>covariateRef</code>, describing the covariates that have been
extracted. This should have the following columns:
<code>covariateId</code>, <code>covariateName</code>,
<code>analysisId</code>, <code>conceptId</code>.</li>
<li>
<code>analysisRef</code>, dscribing the analyses performed by the
function. This should have the following columns:
<code>analysisId</code>, <code>analysisName</code>,
<code>domainIdsta</code>, <code>startDay</code>, <code>endDay</code>,
<code>isBinary</code>, <code>missingMeansZero</code>.</li>
</ul>
<p>Additionally, the object should have an attribute called
<code>metaData</code>, which is a (potentially empty) list of objects
with information on how the <code>CovariateData</code> object was
constructed.</p>
</div>
<div class="section level3">
<h3 id="example-function-1">Example function<a class="anchor" aria-label="anchor" href="#example-function-1"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getDbLooCovariateData</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">connection</span>,</span>
<span>                                  <span class="va">tempEmulationSchema</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                  <span class="va">cdmDatabaseSchema</span>,</span>
<span>                                  <span class="va">cdmVersion</span> <span class="op">=</span> <span class="st">"5"</span>,</span>
<span>                                  <span class="va">cohortTable</span> <span class="op">=</span> <span class="st">"#cohort_person"</span>,</span>
<span>                                  <span class="va">cohortIds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                  <span class="va">rowIdField</span> <span class="op">=</span> <span class="st">"subject_id"</span>,</span>
<span>                                  <span class="va">covariateSettings</span>,</span>
<span>                                  <span class="va">aggregated</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  <span class="va">minCharacterizationMean</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="st">"Constructing length of observation covariates"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">covariateSettings</span><span class="op">$</span><span class="va">useLengthOfObs</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">aggregated</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Aggregation not supported"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Some SQL to construct the covariate:</span></span>
<span>  <span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"SELECT @row_id_field AS row_id, 1 AS covariate_id,"</span>,</span>
<span>    <span class="st">"DATEDIFF(DAY, observation_period_start_date, cohort_start_date)"</span>,</span>
<span>    <span class="st">"AS covariate_value"</span>,</span>
<span>    <span class="st">"FROM @cohort_table c"</span>,</span>
<span>    <span class="st">"INNER JOIN @cdm_database_schema.observation_period op"</span>,</span>
<span>    <span class="st">"ON op.person_id = c.subject_id"</span>,</span>
<span>    <span class="st">"WHERE cohort_start_date &gt;= observation_period_start_date"</span>,</span>
<span>    <span class="st">"AND cohort_start_date &lt;= observation_period_end_date"</span>,</span>
<span>    <span class="st">"{@cohort_ids != -1} ? {AND cohort_definition_id IN (@cohort_ids)}"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu">SqlRender</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/SqlRender/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="va">sql</span>,</span>
<span>    cohort_table <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>    cohort_ids <span class="op">=</span> <span class="va">cohortIds</span>,</span>
<span>    row_id_field <span class="op">=</span> <span class="va">rowIdField</span>,</span>
<span>    cdm_database_schema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu">SqlRender</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/SqlRender/reference/translate.html" class="external-link">translate</a></span><span class="op">(</span><span class="va">sql</span>, targetDialect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">connection</span>, <span class="st">"dbms"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Retrieve the covariate:</span></span>
<span>  <span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/querySql.html" class="external-link">querySql</a></span><span class="op">(</span><span class="va">connection</span>, <span class="va">sql</span>, snakeCaseToCamelCase <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Construct covariate reference:</span></span>
<span>  <span class="va">covariateRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    covariateId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    covariateName <span class="op">=</span> <span class="st">"Length of observation"</span>,</span>
<span>    analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    conceptId <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Construct analysis reference:</span></span>
<span>  <span class="va">analysisRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    analysisName <span class="op">=</span> <span class="st">"Length of observation"</span>,</span>
<span>    domainId <span class="op">=</span> <span class="st">"Demographics"</span>,</span>
<span>    startDay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    endDay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    isBinary <span class="op">=</span> <span class="st">"N"</span>,</span>
<span>    missingMeansZero <span class="op">=</span> <span class="st">"Y"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Construct analysis reference:</span></span>
<span>  <span class="va">metaData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sql <span class="op">=</span> <span class="va">sql</span>, call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.call.html" class="external-link">match.call</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">Andromeda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Andromeda/man/andromeda_constructor.html" class="external-link">andromeda</a></span><span class="op">(</span></span>
<span>    covariates <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>    covariateRef <span class="op">=</span> <span class="va">covariateRef</span>,</span>
<span>    analysisRef <span class="op">=</span> <span class="va">analysisRef</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"metaData"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">metaData</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"CovariateData"</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this example function, we construct a single covariate called
‘Length of observation’, which is the number of days between the
<code>observation_period_start_date</code> and the index date. We use
parameterized SQL and the <code>SqlRender</code> package to generate the
appropriate SQL statement for the database to which we are connected. We
also create the covariate reference and analysis reference objects,
which have one row each, specifying our one covariate and one analysis.
We then wrap up the <code>covariate</code>, <code>covariateRef</code>,
and <code>analysisRef</code> objects in a single result Andromeda
object, together with some meta-data.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-the-custom-covariate-builder">Using the custom covariate builder<a class="anchor" aria-label="anchor" href="#using-the-custom-covariate-builder"></a>
</h2>
<p>We can use our custom covariate builder in the
<code>PatientLevelPrediction</code> package, as well other packages that
depend on the <code>FeatureExtraction</code> package, such as the
<code>CohortMethod</code> package. If we want to use only our custom
defined covariate builder, we can simply replace the existing
<code>covariateSettings</code> with our own, for example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">looCovSet</span> <span class="op">&lt;-</span> <span class="fu">createLooCovariateSettings</span><span class="op">(</span>useLengthOfObs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbCovariateData.html">getDbCovariateData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="va">resultsDatabaseSchema</span>,</span>
<span>  cohortTable <span class="op">=</span> <span class="st">"rehospitalization"</span>,</span>
<span>  cohortIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="va">looCovSet</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this case we will have only one covariate for our predictive
model, the length of observation. In most cases, we will want our custom
covariates in addition to the default covariates. We can do this by
creating a list of covariate settings:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span><span class="op">(</span></span>
<span>  useDemographicsGender <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsAgeGroup <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsRace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsEthnicity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsIndexYear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsIndexMonth <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">looCovSet</span> <span class="op">&lt;-</span> <span class="fu">createLooCovariateSettings</span><span class="op">(</span>useLengthOfObs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariateSettingsList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covariateSettings</span>, <span class="va">looCovSet</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbCovariateData.html">getDbCovariateData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="va">resultsDatabaseSchema</span>,</span>
<span>  cohortTable <span class="op">=</span> <span class="st">"rehospitalization"</span>,</span>
<span>  cohortIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="va">covariateSettingsList</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this example both demographic covariates and our length of
observation covariate will be generated and can be used in our
predictive model.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martijn Schuemie, Marc Suchard, Patrick Ryan, Jenna Reps, Anthony Sena, Ger Inberg.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
