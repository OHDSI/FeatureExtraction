<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating covariates based on other cohorts • FeatureExtraction</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating covariates based on other cohorts">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FeatureExtraction</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CreatingCovariatesBasedOnOtherCohorts.html">Creating covariates based on other cohorts</a>
    </li>
    <li>
      <a href="../articles/CreatingCovariatesUsingCohortAttributes.html">Creating covariates using cohort attributes</a>
    </li>
    <li>
      <a href="../articles/CreatingCustomCovariateBuilders.html">Creating custom covariate builders</a>
    </li>
    <li>
      <a href="../articles/CreatingCustomCovariateBuildersKorean.html">Creating custom covariate builders (Korean)</a>
    </li>
    <li>
      <a href="../articles/UsingFeatureExtraction.html">Using FeatureExtraction</a>
    </li>
    <li>
      <a href="../articles/UsingFeatureExtractionKorean.html">Using FeatureExtraction (Korean)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/FeatureExtraction/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating covariates based on other cohorts</h1>
                        <h4 data-toc-skip class="author">Martijn J.
Schuemie</h4>
            
            <h4 data-toc-skip class="date">2025-10-28</h4>

      <small class="dont-index">Source: <a href="https://github.com/OHDSI/FeatureExtraction/blob/HEAD/vignettes/CreatingCovariatesBasedOnOtherCohorts.Rmd" class="external-link"><code>vignettes/CreatingCovariatesBasedOnOtherCohorts.Rmd</code></a></small>
      <div class="hidden name"><code>CreatingCovariatesBasedOnOtherCohorts.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette assumes you are already familiar with the
<code>FeatureExtraction</code> package.</p>
<p>The <code>FeatureExtraction</code> package can generate a default set
of covariates, such as one covariate for each condition found in the
<code>condition_occurrence</code> table. These covariates are based on
the concepts found in the data in the Common Data Model (CDM). For
example, if we wish to have a covariate for ‘prior diabetes’, the
default set of covariates includes a covariate based on the condition
concept <code>Diabetes melitus</code> and all of its descendant
concepts.</p>
<p>In this vignette we review how we can create covariates based on
other cohorts instead of concepts by themselves. In our diabetes
example, we may wish to define diabetes not just as the occurrence of a
diagnose code, but also require records of anti-diabetic treatments, or
blood glucose values exceeding certain thresholds. We can construct a
complicated cohort definition, for example using the OHDSI ATLAS tool,
encoding this logic. We can instantiate this cohort, and then construct
covariates based on the presence or absence of this cohort in a
patient’s history.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>To construct covariates based on other cohorts, the following steps
must be taken:</p>
<ol style="list-style-type: decimal">
<li>Populate a table with the cohorts to be used for covariate
construction.</li>
<li>Use the <code><a href="../reference/createCohortBasedCovariateSettings.html">createCohortBasedCovariateSettings()</a></code> or
<code><a href="../reference/createCohortBasedTemporalCovariateSettings.html">createCohortBasedTemporalCovariateSettings()</a></code> function to
create a <code>covariateSettings</code> object pointing to the cohorts
mentioned in the previous steps.</li>
</ol>
<div class="section level3">
<h3 id="populate-a-table-with-the-cohorts-to-be-used-for-covariate-construction-">Populate a table with the cohorts to be used for covariate
construction.<a class="anchor" aria-label="anchor" href="#populate-a-table-with-the-cohorts-to-be-used-for-covariate-construction-"></a>
</h3>
<p>The cohorts should be loaded into a cohort table with the standard
fields. <strong>This can be the same table as the one containing the
main cohorts</strong>. The table should at least have the following
fields:</p>
<ul>
<li>
<code>cohort_definition_id</code>, A unique identifier for the
cohort. This ID will be used (together with the analysis ID) to
construct the covariate ID, so <strong>ensure that the
<code>cohort_definition_id</code> fits in a 32-bit integer</strong>* (so
between -2,147,483,648 and 2,147,483,647).</li>
<li>
<code>subject_id</code>, The unique identifier for the person.
Should match the <code>person_id</code> in the CDM.</li>
<li>
<code>cohort_start_date</code>, The date the person enters the
cohort.</li>
<li>
<code>cohort_end_date</code>, The date the the person exits the
cohort. If <code>null</code>, the person is assumed to exit the cohort
on the same date as entering it.</li>
</ul>
<p>A person can enter and exit a cohort multiple times, but cannot be in
the same cohort at the same time multiple times (this is true for all
cohorts in OHDSI).</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="section level3">
<h3 id="creating-the-cohort-attributes-and-attributes-definitions">Creating the cohort attributes and attributes definitions<a class="anchor" aria-label="anchor" href="#creating-the-cohort-attributes-and-attributes-definitions"></a>
</h3>
<p>In this example we will create two cohorts: the main cohort is people
initiating diclofenac treatment for the first time. The cohort we wish
to use to construct a covariate is type 2 diabetes, requiring both a
diagnosis code and a treatment code (in the 30 days following the
diagnosis). The diabetes cohort is assumed to start at the first
diagnosis meeting the criteria, and end when observation ends
(chronic).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">/************************</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">File covariateCohorts.sql</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">*************************/</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> @cohort_database_schema.@cohort_table;</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> @cohort_database_schema.@cohort_table (</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    cohort_definition_id <span class="dt">INT</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    subject_id BIGINT,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    cohort_start_date <span class="dt">DATE</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    cohort_end_date <span class="dt">DATE</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    );</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @cohort_database_schema.@cohort_table (</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    cohort_definition_id,</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    subject_id,</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    cohort_start_date,</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    cohort_end_date</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    )</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dv">1</span>,</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    person_id,</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>    <span class="fu">MIN</span>(drug_era_start_date),</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>    <span class="fu">MIN</span>(drug_era_end_date)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="kw">FROM</span> @cdm_database_schema.drug_era</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="kw">WHERE</span> drug_concept_id <span class="op">=</span> <span class="dv">1124300</span> <span class="co">--diclofenac</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> person_id;</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @cohort_database_schema.@cohort_table (</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>    cohort_definition_id,</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>    subject_id,</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>    cohort_start_date,</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>    cohort_end_date</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>    )</span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dv">2</span>,</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>    condition_occurrence.person_id,</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>    <span class="fu">MIN</span>(condition_start_date),</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>    <span class="fu">MIN</span>(observation_period_end_date)</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="kw">FROM</span> @cdm_database_schema.condition_occurrence</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm_database_schema.drug_exposure</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>    <span class="kw">ON</span> condition_occurrence.person_id <span class="op">=</span> drug_exposure.person_id</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>        <span class="kw">AND</span> drug_exposure_start_date <span class="op">&gt;=</span> condition_start_date</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>        <span class="kw">AND</span> drug_exposure_start_date <span class="op">&lt;</span> DATEADD(<span class="dt">DAY</span>, <span class="dv">30</span>, condition_start_date)</span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm_database_schema.observation_period</span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>    <span class="kw">ON</span> condition_occurrence.person_id <span class="op">=</span> observation_period.person_id</span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>        <span class="kw">AND</span> condition_start_date <span class="op">&gt;=</span> observation_period_start_date</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>        <span class="kw">AND</span> condition_start_date <span class="op">&lt;=</span> observation_period_end_date</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="kw">WHERE</span> condition_concept_id <span class="kw">IN</span> (</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>        <span class="kw">SELECT</span> descendant_concept_id</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>        <span class="kw">FROM</span> @cdm_database_schema.concept_ancestor</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>        <span class="kw">WHERE</span> ancestor_concept_id <span class="op">=</span> <span class="dv">201826</span> <span class="co">-- Type 2 diabetes mellitus</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>        )</span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a>    <span class="kw">AND</span> drug_concept_id <span class="kw">IN</span> (</span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>        <span class="kw">SELECT</span> descendant_concept_id</span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>        <span class="kw">FROM</span> @cdm_database_schema.concept_ancestor</span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a>        <span class="kw">WHERE</span> ancestor_concept_id <span class="op">=</span> <span class="dv">21600712</span> <span class="co">-- DRUGS USED IN DIABETES (ATC A10)</span></span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a>        )</span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> condition_occurrence.person_id;</span></code></pre></div>
<p>We substitute the arguments in this SQL with actual values, translate
it to the right SQL dialect, and execute the SQL:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/SqlRender/" class="external-link">SqlRender</a></span><span class="op">)</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/SqlRender/reference/readSql.html" class="external-link">readSql</a></span><span class="op">(</span><span class="st">"covariateCohorts.sql"</span><span class="op">)</span></span>
<span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">connect</span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span><span class="fu">renderTranslateExecuteSql</span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  sql <span class="op">=</span> <span class="va">sql</span>,</span>
<span>  cdm_database_schema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  cohort_database_schema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  cohort_table <span class="op">=</span> <span class="va">cohortTable</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If all went well, we now have a table with the cohorts. We can see
how many cohorts per type:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"SELECT cohort_definition_id,</span></span>
<span><span class="st">                COUNT(*) AS count"</span>,</span>
<span>  <span class="st">"FROM @cohort_database_schema.@cohort_table"</span>,</span>
<span>  <span class="st">"GROUP BY cohort_definition_id"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">renderTranslateQuerySql</span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  sql <span class="op">=</span> <span class="va">sql</span>,</span>
<span>  cohort_database_schema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  cohort_table <span class="op">=</span> <span class="va">cohortTable</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   cohort_concept_id  count</span></span>
<span><span class="co">## 1                 1 954179</span></span>
<span><span class="co">## 2                 2 979874</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="using-the-cohort-as-covariate">Using the cohort as covariate<a class="anchor" aria-label="anchor" href="#using-the-cohort-as-covariate"></a>
</h3>
<p>To use the constructed diabetes cohort as a covariate, we need to
create a <code>covariateSettings</code> object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariateCohorts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  cohortId <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cohortName <span class="op">=</span> <span class="st">"Type 2 diabetes"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCohortBasedCovariateSettings.html">createCohortBasedCovariateSettings</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">999</span>,</span>
<span>  covariateCohorts <span class="op">=</span> <span class="va">covariateCohorts</span>,</span>
<span>  valueType <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  startDay <span class="op">=</span> <span class="op">-</span><span class="fl">365</span>,</span>
<span>  endDay <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here we first create a tibble containing two columns. The
<code>cohortId</code> column lists the cohort definition IDs used in our
cohort table. The <code>cohortName</code> column will be used to create
the covariate names. In this case, we only have one cohort in this
table, but there could be many. A separate covariate will be created for
each cohort.</p>
<p>We then specify an analysis which we assign a unique ID (between 1
and 999). We specify we want to create binary covariates, meaning the
covariate will have value = 1 if the cohort is found during the window,
and value = 0 if not found. (Because we typically use sparse matrices to
represent our covariates, entries with value = 0 will not be included).
Alternatively, we could have set <code>valueType = "count"</code>, in
which case the covariate value would be the number of times the cohort
was observed in the time window. Finally, we specify the covariate
capture window spans the 365 days before (and including) entry into the
main (diclofenac) cohort.</p>
<p>We could also specify the cohort database schema and table where the
cohorts for constructing the covariates can be found. However, because
both the main cohorts and covariate cohorts are in the same table this
is not necessary.</p>
<p>We can now construct the covariates:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariateData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbCovariateData.html">getDbCovariateData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  cohortTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  cohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  rowIdField <span class="op">=</span> <span class="st">"subject_id"</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="va">covariateSettings</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">covariateData</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariateData</span><span class="op">$</span><span class="va">covariateRef</span></span></code></pre></div>
<p>In this case we will have only one covariate, diabetes in the year
before index. In most cases, we will want our custom covariates in
addition to the default covariates. We can do this by creating a list of
covariate settings:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariateSettings1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span><span class="op">(</span></span>
<span>  useDemographicsGender <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsAgeGroup <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsRace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsEthnicity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsIndexYear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useDemographicsIndexMonth <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariateCohorts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  cohortId <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cohortName <span class="op">=</span> <span class="st">"Type 2 diabetes"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariateSettings2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCohortBasedCovariateSettings.html">createCohortBasedCovariateSettings</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">999</span>,</span>
<span>  covariateCohorts <span class="op">=</span> <span class="va">covariateCohorts</span>,</span>
<span>  valueType <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  startDay <span class="op">=</span> <span class="op">-</span><span class="fl">365</span>,</span>
<span>  endDay <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariateSettingsList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covariateSettings1</span>, <span class="va">covariateSettings2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariateData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbCovariateData.html">getDbCovariateData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  cohortTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  cohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  rowIdField <span class="op">=</span> <span class="st">"subject_id"</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="va">covariateSettingsList</span>,</span>
<span>  aggregated <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">covariateData</span><span class="op">)</span></span></code></pre></div>
<p>In this example both demographic covariates and our diabetes
covariate were generated. Note that, for illustration purposes, here we
opted for aggregated covariates.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martijn Schuemie, Marc Suchard, Patrick Ryan, Jenna Reps, Anthony Sena, Ger Inberg.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
